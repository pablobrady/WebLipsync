/*! WebLipsync 2016-01-22 */
var externalLipsyncData=[[0,0],[1,1],[2,1],[3,1],[4,1],[1,1],[2,1],[2,1],[3,1],[3,1],[3,1],[3,1],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2,0],[3,0],[3,0],[1,0],[3,0],[6,0],[1,0],[2,0],[3,0],[4,0],[4,0],[3,0],[3,0],[0,0],[1,0],[2,0],[2,0],[1,0],[1,0],[6,0],[6,0],[6,0],[6,0],[0,0],[2,0],[6,0],[6,0],[3,0],[3,0],[3,0],[3,0],[3,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2,0],[2,0],[3,0],[1,0],[1,0],[4,0],[2,0],[3,0],[0,0],[2,0],[3,0],[4,0],[6,0],[2,0],[2,0],[6,0],[2,0],[3,0],[4,0],[1,0],[1,0],[1,0],[3,0],[3,0],[0,0],[1,0],[0,0],[0,0],[0,0],[6,0],[3,0],[1,0],[1,0],[1,0],[2,0],[3,0],[3,0],[0,0],[0,0],[0,0],[0,0],[4,0],[4,0],[6,0],[2,0],[1,0],[3,0],[0,0],[2,0],[1,0],[1,0],[5,0],[0,0],[4,3],[3,0],[3,0],[3,0],[2,0],[2,0],[6,0],[1,0],[1,0],[3,0],[2,0],[0,0],[6,0],[2,0],[2,0],[3,0],[3,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[1,1],[1,1],[1,1],[1,1],[1,1],[1,1],[1,1],[1,1],[1,1],[1,1],[1,1],[1,1],[1,1],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[4,3],[4,3],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[0,1],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3]];;/*! WebLipsync 2016-01-22 */
var LipSyncManager=function(a){this.currentHeadId=0,this.currentHeadIndex=0,this.lipsyncDataLength=0,this.isAudioLoaded=!1,this.isPlaying=!1,this.initObj||(this.initObj={}),a.hasOwnProperty("canvasId")?this.canvasId=a.canvasId:this.canvasId=this.getDefaults().canvasId,a.hasOwnProperty("spriteSheetFilename")?this.spriteSheetFilename=a.spriteSheetFilename:this.spriteSheetFilename=this.getDefaults().spriteSheetFilename,a.hasOwnProperty("fps")?this.fps=a.fps:this.fps=this.getDefaults().fps,a.hasOwnProperty("phonemes")?this.phonemes=a.phonemes:this.phonemes=this.getDefaults().phonemes,a.hasOwnProperty("headWidth")?this.headWidth=a.headWidth:this.headWidth=this.getDefaults().headWidth,a.hasOwnProperty("headHeight")?this.headHeight=a.headHeight:this.headHeight=this.getDefaults().headHeight,a.hasOwnProperty("spriteSheetWidth")?this.spriteSheetWidth=a.spriteSheetWidth:this.spriteSheetWidth=this.getDefaults().spriteSheetWidth,a.hasOwnProperty("spriteSheetHeight")?this.spriteSheetHeight=a.spriteSheetHeight:this.spriteSheetHeight=this.getDefaults().spriteSheetHeight,a.hasOwnProperty("expressions")?this.expressions=a.expressions:this.expressions=this.getDefaults().expressions,a.hasOwnProperty("audioPlayerId")?this.audioPlayerId=a.audioPlayerId:this.audioPlayerId=this.getDefaults().audioPlayerId,this.audioPlayerElement=document.getElementById(this.audioPlayerId),a.hasOwnProperty("soundFile")?this.soundFile=a.soundFile:(this.soundFile=this.getDefaults().soundFile,console.log("LipSyncManager ERROR:  No soundFile specified.  Using default '"+this.soundFile+"'.")),a.hasOwnProperty("lipsyncData")?this.lipsyncData=a.lipsyncData:(this.lipsyncData=this.getDefaults().lipsyncData,console.log("LipSyncManager ERROR:  No LipsyncData specified.  Using default.")),this.lipsyncDataLength=this.lipsyncData.length,a.hasOwnProperty("headId")?this.headId=a.headId:(this.headId=this.getDefaults().headId,console.log("LipSyncManager ERROR:  No headId specified.  Using default '"+this.headId+"'.")),this.headElement=document.getElementById(this.headId),a.hasOwnProperty("onReady")?this.onReady=a.onReady:(this.onReady=this.getDefaults().onReady,console.log("LipSyncManager WARNING:  No 'onReady' function specified.")),this.loadAudio(this.soundFile)};LipSyncManager.prototype.getDefaults=function(){return{canvasId:"cartoonCanvas",spriteSheetFilename:"images/ali_front_faces.png",fps:12,phonemes:6,headWidth:200,headHeight:175,spriteSheetWidth:1400,spriteSheetHeight:700,expressions:0,audioPlayerId:"audioPlayerId",soundFile:"audio/defaultAudio.mp3",lipsyncData:[[0,0],[1,0],[2,0],[3,0],[4,0],[5,0],[6,0],[6,0],[0,1],[1,1],[2,1],[3,1],[4,1],[5,1],[6,1],[6,1],[0,2],[1,2],[2,2],[3,2],[4,2],[5,2],[6,2],[6,2]],headId:"headId",onReady:function(a){console.log("Default onReady callback!  Will play ASAP.")}}},LipSyncManager.prototype.loadAudio=function(a){var b=a.replace(".mp3",".ogg");document.getElementById("mp3Source").src=a,document.getElementById("oggSource").src=b;var c=this;return this.audioPlayerElement.addEventListener("canplaythrough",function(){c.isAudioLoaded=!0}),this.audioPlayerElement.load(),!0},LipSyncManager.prototype.play=function(){this.isAudioLoaded&&(this.isPlaying?this.stop():(this.audioPlayerElement.play(),this.isPlaying=!0,this.currentHeadIndex=0,this.currentHeadId=0,this.startTimerTick()))},LipSyncManager.prototype.stop=function(){this.isAudioLoaded&&(clearTimeout(window.lipsyncManagerTimeout),this.audioPlayerElement.pause(),this.audioPlayerElement.currentTime=0,this.isPlaying=!1,this.currentHeadIndex=0,this.currentHeadId=0)},LipSyncManager.prototype.startTimerTick=function(){clearTimeout(window.lipsyncManagerTimeout);var a=this;window.lipsyncManagerTimeout=setTimeout(a.updateTimedHeadIndex.bind(a),1e3/this.fps)},LipSyncManager.prototype.updateTimedHeadIndex=function(){return this.currentHeadIndex=this.currentHeadIndex+1,this.currentHeadIndex>=this.lipsyncDataLength?void this.stop():void this.startTimerTick()},LipSyncManager.prototype.getCurrentHeadId=function(){return this.currentHeadIndex>=this.lipsyncDataLength?this.lipsyncData[0][0]:this.lipsyncData[this.currentHeadIndex][0]},LipSyncManager.prototype.getCurrentExpressionId=function(){return this.currentHeadIndex>=this.lipsyncDataLength?this.lipsyncData[0][1]:this.lipsyncData[this.currentHeadIndex][1]};;/*! WebLipsync 2016-01-22 */
window.lipsyncSpeed=1,window.lipsyncEnum={},window.lipsyncEnum.spriteType={LIPSYNCED:1,STATIC:2},window.globalAppSettings={aliHead_x:375,aliHead_y:80,aliBody_x:300,aliBody_y:60,aliBody_width:481,aliBody_height:629,cartoonCanvasWidth:1e3,cartoonCanvasHeight:750};var lipsMgr=new LipSyncManager({canvasId:"cartoonCanvas",spriteSheetFilename:"images/ali_front_faces.png",fps:12,phonemes:6,headWidth:200,headHeight:175,spriteSheetWidth:1400,spriteSheetHeight:700,expressions:0,audioPlayerId:"audioPlayerId",soundFile:"audio/ali_intro.mp3",lipsyncData:externalLipsyncData,headId:"aliHead-01"});document.querySelector("#stopButton").addEventListener("click",function(){lipsMgr.stop()}),document.querySelector("#playButton").addEventListener("click",function(){lipsMgr.play()}),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(){function a(){window.requestAnimationFrame(a),e.update(),c.render(),e.render()}function b(a){var b={},c=0,d=0,e=a.ticksPerFrame||0,f=a.numberOfFrames||1;return b.spriteType=a.spriteType,b.context=a.context,b.width=a.width,b.height=a.height,b.image=a.image,b.update=function(){b.spriteType==window.lipsyncEnum.spriteType.LIPSYNCED&&(d+=1,d>e&&(d=0,f-1>c?c+=1:c=0))},b.render=function(){a.spriteType===window.lipsyncEnum.spriteType.STATIC?(b.context.clearRect(0,0,window.globalAppSettings.cartoonCanvasWidth,window.globalAppSettings.cartoonCanvasWidth),b.context.drawImage(b.image,0,0,window.globalAppSettings.aliBody_width,window.globalAppSettings.aliBody_height,window.globalAppSettings.aliBody_x,window.globalAppSettings.aliBody_y,window.globalAppSettings.aliBody_width,window.globalAppSettings.aliBody_height)):a.spriteType===lipsyncEnum.spriteType.LIPSYNCED&&b.context.drawImage(b.image,Number(lipsMgr.getCurrentHeadId())*lipsMgr.headWidth,Number(lipsMgr.getCurrentExpressionId())*lipsMgr.headHeight,lipsMgr.headWidth,lipsMgr.headHeight,window.globalAppSettings.aliHead_x,window.globalAppSettings.aliHead_y,lipsMgr.headWidth,lipsMgr.headHeight)},b}var c,d,e,f,g;g=document.getElementById("cartoonCanvas"),g.width=1e3,g.height=750,d=new Image,d.src="images/ali_body.png",c=b({spriteType:window.lipsyncEnum.spriteType.STATIC,context:g.getContext("2d"),width:1400,height:700,image:d,numberOfFrames:1,ticksPerFrame:0}),f=new Image,f.addEventListener("load",a),f.src="images/ali_front_faces.png",e=b({spriteType:window.lipsyncEnum.spriteType.LIPSYNCED,context:g.getContext("2d"),width:1400,height:700,image:f,numberOfFrames:lipsMgr.phonemes,ticksPerFrame:4})}();